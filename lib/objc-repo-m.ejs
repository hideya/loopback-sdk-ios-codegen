//
// <%- meta.objcRepoName %>.m
//

#import "<%- meta.objcRepoName %>.h"

@implementation <%- meta.objcRepoName %>

+ (instancetype)repository {
    return [self repositoryWithClassName:@"<%- meta.pluralName %>"];
}

- (<%- meta.objcModelName %> *)modelWithDictionary:(NSDictionary *)dictionary {
    return (<%- meta.objcModelName %> *)[super modelWithDictionary:dictionary];
}

- (SLRESTContract *)contract {
    SLRESTContract *contract = [super contract];

<% meta.methods.forEach(function (method) {
     if (method.objcGenerated) {
-%>
    [contract addItem:[SLRESTContractItem itemWithPattern:[NSString stringWithFormat:@"/%@<%- method.routes[0].path %>", self.className]
                                                     verb:@"<%- method.routes[0].verb.toUpperCase() %>"]
            forMethod:[NSString stringWithFormat:@"%@.<%- method.name %>", self.className]];
<%   }
   });
-%>

    return contract;
}

<% meta.objcMethods.forEach(function(method) { -%>

- <%- method.prototype %> {
     [self invokeStaticMethod:@"<%- method.rawName %>"
                   parameters:@{ <%- method.paramAssignments %> }
<%   if (method.bodyParamAssignments) { -%>
               bodyParameters:<%- method.bodyParamAssignments %>
<%   } -%>
                      success:^(id value) {
<%   if (method.successBlockType === meta.objcModelName + 'ObjectSuccessBlock') { -%>
                        NSAssert([[value class] isSubclassOfClass:[NSDictionary class]], @"Received non-Dictionary: %@", value);
                        success((<%- meta.objcModelName %>*)[self modelWithDictionary:value]);
<%   } else if (method.successBlockType === 'LBPersistedModelArraySuccessBlock') { -%>
                        NSAssert([[value class] isSubclassOfClass:[NSArray class]], @"Received non-Array: %@", value);
                        NSMutableArray *models = [NSMutableArray array];
                        [value enumerateObjectsUsingBlock:^(id obj, NSUInteger idx, BOOL *stop) {
                            [models addObject:[self modelWithDictionary:obj]];
                        }];
                        success(models);
<%   } else if (method.successBlockType === 'LBPersistedModelBoolSuccessBlock') { -%>
                        success(((NSNumber *)value[@"<%- method.returnArg %>"]).boolValue);
<%   } else if (method.successBlockType === 'LBPersistedModelNumberSuccessBlock') { -%>
                        success(((NSNumber *)value[@"<%- method.returnArg %>"]).integerValue);
<%   } else if (method.successBlockType === 'LBPersistedModelVoidSuccessBlock') { -%>
                        success();
<%   } -%>
                      }
                      failure:failure];
}
<%
   });
-%>

@end
